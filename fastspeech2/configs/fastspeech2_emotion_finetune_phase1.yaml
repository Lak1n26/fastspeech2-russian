defaults:
  - model: fastspeech2
  - writer: cometml
  - datasets: ruslan_features_emotion
  - dataloader: tts_features
  - metrics: null
  - _self_

optimizer:
  _target_: torch.optim.AdamW
  lr: 1e-4
  betas: [0.9, 0.98]
  eps: 1e-9
  weight_decay: 1e-6

lr_scheduler:
  _target_: torch.optim.lr_scheduler.OneCycleLR
  max_lr: 1e-4
  pct_start: 0.1
  anneal_strategy: cos
  total_steps: null

loss_function:
  _target_: fastspeech2.loss.FastSpeech2LossWrapper
  mel_loss_type: mae
  lambda_mel: 7.0
  lambda_duration: 1.0
  lambda_pitch: 0.05
  lambda_energy: 0.05
  lambda_emotion: 5.0

metrics:
  train:
    - _target_: fastspeech2.metrics.MelSpectrogramMAE
      name: mel_mae
    - _target_: fastspeech2.metrics.DurationMAE
      name: duration_mae
    - _target_: fastspeech2.metrics.PitchMAE
      name: pitch_mae
    - _target_: fastspeech2.metrics.EnergyMAE
      name: energy_mae

  val:
    - _target_: fastspeech2.metrics.MelSpectrogramMAE
      name: mel_mae
    - _target_: fastspeech2.metrics.MelSpectrogramMSE
      name: mel_mse
    - _target_: fastspeech2.metrics.MelSpectrogramL2Norm
      name: mel_l2
    - _target_: fastspeech2.metrics.DurationAccuracy
      name: duration_accuracy
      tolerance: 5
    - _target_: fastspeech2.metrics.DurationMAE
      name: duration_mae
    - _target_: fastspeech2.metrics.PitchMAE
      name: pitch_mae
    - _target_: fastspeech2.metrics.EnergyMAE
      name: energy_mae

trainer:
  n_epochs: 10
  epoch_len: null
  log_step: 100
  device_tensors: ["text_tokens", "mel", "duration", "pitch", "energy", "emotion"]
  resume_from: null
  device: auto
  override: false
  monitor: "min val_loss"
  save_period: 1
  early_stop: 15
  save_dir: "saved"
  seed: 42
  grad_clip_thresh: 1.0
  max_grad_norm: 1.0
  use_amp: false

  freeze_encoder_decoder: true
  freeze_all_except_emotion: true
  unfreeze_after_epoch: null
  force_new_cometml_run: true
  reset_epoch_counter: true

vocoder:
  enabled: true
  checkpoint_path: "saved/waveglow/model.ckpt-610000.pt"
  params_path: "waveglow_params.json"

inference:
  duration_control: 1.0
  pitch_control: 1.0
  energy_control: 1.0
  emotion_control: 1.0
